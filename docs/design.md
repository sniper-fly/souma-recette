# 要件定義ツール - 確定要件

## 概要

GPT Realtime APIを使用した、音声対話による要件定義支援Webアプリケーション

## 技術スタック

| 項目 | 選択 |
|------|------|
| フロントエンド | Next.js + TypeScript |
| CSS | Tailwind CSS |
| バックエンド | Next.js API Routes（分離管理） |
| Realtime接続 | WebRTC（バックエンド経由リレー） |
| AI | gpt-realtime, gpt-5.2 |
| ブラウザ対応 | Chrome最新版のみ |

## 機能要件

1. 音声入力: ユーザーがマイクで作りたいものを説明
2. リアルタイム対話: GPTが要件・不足点を質問し、深掘り
3. デュアル出力: GPTの応答は音声＋テキスト両方で表示
4. 要件定義書生成: Markdown形式で出力
5. 完了判定: ユーザー指示またはGPT判断の両方対応

## 非機能要件

- 会話履歴の永続化: 不要（セッション単位で完結）
- 音声: デフォルト（alloy）固定
- Azure認証情報: 環境変数で設定済み前提

## 設定管理

| 項目 | 管理方法 |
|------|----------|
| システムプロンプト | 設定ファイル（YAML） |
| Azure OpenAIモデル | 設定ファイル |

## UI仕様

### 画面構成

| 項目 | デスクトップ | モバイル |
|------|------------|---------|
| レイアウト | 2ペイン分割（左6:右4） | 上下分割 |
| 要件定義書 | 左ペイン・固定高さ・独立スクロール | 上部固定・画面の40%・内部スクロール |
| 会話エリア | 右ペイン・独立スクロール | 下部・独立スクロール |
| 会話表示件数 | 直近3件 | 直近3件 |
| 選択肢表示 | 会話エリア内にボタンとして表示 | 同左 |
| 操作ボタン | 画面最下部に固定表示 | 同左 |

#### デスクトップ（2ペイン分割 6:4）

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│  ┌───────────────────────────────┐ ┌─────────────────────────┐  │
│  │                               │ │                         │  │
│  │      要件定義書エリア          │ │     会話エリア           │  │
│  │      (左ペイン 60%)           │ │     (右ペイン 40%)       │  │
│  │                               │ │                         │  │
│  │  ┌─────────────────────────┐  │ │  ┌───────────────────┐  │  │
│  │  │ # 要件定義書            │  │ │  │ GPT: 〇〇について  │  │  │
│  │  │                         │  │ │  │ 教えてください     │  │  │
│  │  │ ## 概要                 │  │ │  └───────────────────┘  │  │
│  │  │ ...                     │  │ │                         │  │
│  │  │                         │  │ │  ┌───────────────────┐  │  │
│  │  │ ## 機能要件             │  │ │  │ User: △△です     │  │  │
│  │  │ ...                     │  │ │  └───────────────────┘  │  │
│  │  │                    ↕scroll│ │ │                         │  │
│  │  └─────────────────────────┘  │ │  ┌───────────────────┐  │  │
│  │                               │ │  │ GPT: では□□は？   │  │  │
│  │                               │ │  └───────────────────┘  │  │
│  │                               │ │                         │  │
│  │                               │ │  [選択肢A] [選択肢B]    │  │
│  │                               │ │                    ↕scroll│
│  └───────────────────────────────┘ └─────────────────────────┘  │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│              [開始]  [一時停止/再開]  [終了]                     │
└─────────────────────────────────────────────────────────────────┘
```

#### モバイル（上下分割）

```
┌─────────────────────┐
│                     │
│  要件定義書エリア    │
│  (上部固定 40%)      │
│                     │
│ ┌─────────────────┐ │
│ │ # 要件定義書    │ │
│ │ ## 概要         │ │
│ │ ...        ↕scroll│
│ └─────────────────┘ │
│                     │
├─────────────────────┤
│                     │
│  会話エリア          │
│  (下部 60%)          │
│                     │
│ ┌─────────────────┐ │
│ │ GPT: 〇〇は？   │ │
│ └─────────────────┘ │
│                     │
│ ┌─────────────────┐ │
│ │ User: △△です  │ │
│ └─────────────────┘ │
│                     │
│ ┌─────────────────┐ │
│ │ GPT: では□□？ │ │
│ └─────────────────┘ │
│                     │
│ [選択肢A] [選択肢B] │
│                ↕scroll│
├─────────────────────┤
│ [開始] [停止] [終了] │
└─────────────────────┘
```

### 操作ボタン

- 開始ボタン
- 一時停止 / 再開ボタン
- 終了ボタン

### レスポンシブ対応

- デスクトップ: 2ペイン横並び
- タブレット / スマートフォン: 上下分割

## フロー仕様

### マイク許可

- 開始ボタン押下時にブラウザのマイク許可ダイアログを表示

### 完了判定

- GPTが要件十分と判断した場合、完了を提案
- ユーザーが確認ボタンで承認後、セッション終了
- ユーザーからの明示的な終了指示でも終了可能

### 要件定義書生成

- 会話中にリアルタイムで更新表示

### ダウンロード

- Markdownファイルとしてダウンロード
- クリップボードへコピー
- 両方の機能を提供

## エラーハンドリング

対応範囲（標準）:

- 接続エラー: ユーザーへ通知、再接続を促す
- 認証エラー: ユーザーへ通知
- 音声認識エラー: ユーザーへ通知

## アーキテクチャ

### 2段構成

```
┌─────────────────┐    function_calling    ┌─────────────────┐
│  GPT Realtime   │ ──────────────────────→│  GPT-5.2等      │
│  (音声対話)      │    文字起こしを逐次送信   │  (要件統合)      │
└─────────────────┘                        └─────────────────┘
                                                    │
                                                    ▼
                                           ┌─────────────────┐
                                           │  要件定義書      │
                                           │  (リアルタイム更新)│
                                           └─────────────────┘
```

| コンポーネント | 役割 |
|---------------|------|
| GPT Realtime | 音声入力の文字起こし、function_callingで逐次送信 |
| 別モデル（GPT-5.2等） | 既存の要件定義書と統合、差分更新を実行 |

### デプロイ

| フェーズ | 対応 |
|---------|------|
| 当面 | ローカル開発のみ |
| 将来 | Terraformデプロイ（スコープ外）|
